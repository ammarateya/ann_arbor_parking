<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>About - Ann Arbor Parking Citations</title>
    <meta
      name="description"
      content="How the Ann Arbor parking citation scraper works. Learn about the methodology behind real-time parking citation tracking and mapping."
    />

    <!-- Open Graph Tags -->
    <meta property="og:title" content="About - Ann Arbor Parking Citations" />
    <meta
      property="og:description"
      content="How the Ann Arbor parking citation scraper works. Learn about the methodology behind real-time parking citation tracking and mapping."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ og_url }}" />
    <meta property="og:image" content="{{ og_image }}" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:site_name" content="Ann Arbor Parking Citations" />

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="About - Ann Arbor Parking Citations" />
    <meta
      name="twitter:description"
      content="How the Ann Arbor parking citation scraper works. Learn about the methodology behind real-time parking citation tracking and mapping."
    />
    <meta name="twitter:image" content="{{ og_image }}" />

    <!-- Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-J001JG2NJ1"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-J001JG2NJ1");
    </script>

    <style>
      @import url("https://fonts.cdnfonts.com/css/ocr-a-std");
      @import url("https://fonts.cdnfonts.com/css/ocr-b-std");
      @import url("https://fonts.cdnfonts.com/css/nk57-monospace");
      @import url("https://fonts.cdnfonts.com/css/profont");
      @import url("https://fonts.cdnfonts.com/css/terminus-ttf");

      :root {
        --font-display: "OCR A Std", "OCR A Extended", "Courier New", monospace;
        --font-secondary: "OCR B Std", "NK57 Monospace", "ProFontWindows",
          "Terminus (TTF)", monospace;
        --font-body: "NK57 Monospace", "OCR B Std", "ProFontWindows",
          "Terminus (TTF)", monospace;
        --font-micro: "ProFontWindows", "Terminus (TTF)", "OCR A Std",
          "Courier New", monospace;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* Custom text selection */
      ::selection {
        background: rgba(255, 255, 255, 0.85);
        color: #050505;
      }
      ::-moz-selection {
        background: rgba(255, 255, 255, 0.85);
        color: #050505;
      }

      body {
        font-family: var(--font-body);
        background: #0a0a0a;
        color: #00d4ff;
        line-height: 1.6;
        padding: 40px 20px;
        max-width: 900px;
        margin: 0 auto;
      }

      .header {
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 2px solid #00d4ff;
        font-family: var(--font-display);
      }

      h1 {
        font-size: 24px;
        color: #00d4ff;
        text-shadow: 0 0 10px #00d4ff;
        margin-bottom: 10px;
        font-family: var(--font-display);
      }

      .back-link {
        display: inline-block;
        margin-bottom: 20px;
        color: #00d4ff;
        text-decoration: none;
        border: 1px solid #00d4ff;
        padding: 8px 16px;
        transition: all 0.2s;
        font-family: var(--font-display);
        letter-spacing: 1px;
        text-transform: uppercase;
      }

      .back-link:hover {
        background: #00d4ff;
        color: #0a0a0a;
      }

      .content {
        margin-bottom: 40px;
        font-family: var(--font-secondary);
      }

      p {
        margin-bottom: 20px;
        font-size: 14px;
        font-family: var(--font-body);
      }

      .methodology {
        background: rgba(0, 212, 255, 0.05);
        border: 1px solid #00d4ff;
        padding: 20px;
        margin: 30px 0;
        font-family: var(--font-secondary);
      }

      .methodology h2 {
        font-size: 18px;
        margin-bottom: 15px;
        color: #00d4ff;
        font-family: var(--font-display);
      }

      .methodology p {
        color: #ffffff;
      }

      .methodology ul {
        list-style: none;
        padding-left: 0;
      }

      .methodology li {
        margin-bottom: 10px;
        padding-left: 20px;
        position: relative;
        font-size: 14px;
        color: #ffffff;
        font-family: var(--font-secondary);
      }

      .methodology li:before {
        content: "‚ñ∂";
        position: absolute;
        left: 0;
        color: #ffffff;
      }

      .receipt-image {
        margin: 30px 0;
        text-align: center;
      }

      .receipt-image img {
        max-width: 400px;
        width: 100%;
        border: 2px solid #00d4ff;
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
      }

      .receipt-image figcaption {
        margin-top: 10px;
        font-size: 12px;
        color: #888;
        font-style: italic;
      }

      code {
        background: rgba(0, 212, 255, 0.1);
        padding: 2px 6px;
        border: 1px solid #00d4ff;
        font-size: 13px;
        font-family: var(--font-micro);
      }

      .fun-facts {
        background: rgba(0, 212, 255, 0.05);
        border: 1px solid #00d4ff;
        padding: 20px;
        margin: 30px 0;
        font-family: var(--font-secondary);
      }

      .fun-facts h2 {
        font-size: 18px;
        margin-bottom: 20px;
        color: #00d4ff;
        font-family: var(--font-display);
        text-align: center;
      }

      .fun-facts-section {
        margin-bottom: 30px;
      }

      .fun-facts-section h3 {
        font-size: 16px;
        color: #00d4ff;
        margin-bottom: 12px;
        font-family: var(--font-display);
        border-bottom: 1px solid rgba(0, 212, 255, 0.3);
        padding-bottom: 8px;
      }

      .fun-facts-list {
        list-style: none;
        padding: 0;
      }

      .fun-facts-list li {
        padding: 10px;
        margin-bottom: 8px;
        background: rgba(0, 212, 255, 0.03);
        border-left: 3px solid #00d4ff;
        font-size: 14px;
        color: #ffffff;
      }

      .fun-facts-list li strong {
        color: #00d4ff;
        font-family: var(--font-display);
      }

      .loading {
        text-align: center;
        color: #888;
        font-style: italic;
        padding: 20px;
      }

      .error {
        text-align: center;
        color: #ff0040;
        padding: 20px;
        border: 1px solid #ff0040;
        background: rgba(255, 0, 64, 0.1);
      }

      .stat-highlight {
        color: #00d4ff;
        font-weight: bold;
        font-family: var(--font-display);
      }

      .champions-section {
        background: rgba(0, 212, 255, 0.1);
        border: 2px solid #00d4ff;
        padding: 20px;
        margin: 30px 0;
        text-align: center;
      }

      .champions-section h3 {
        font-size: 20px;
        margin-bottom: 20px;
        color: #00d4ff;
        font-family: var(--font-display);
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .champion-item {
        margin: 15px 0;
        padding: 15px;
        background: rgba(0, 212, 255, 0.05);
        border-left: 4px solid #00d4ff;
      }

      .champion-item strong {
        color: #00d4ff;
        font-family: var(--font-display);
        font-size: 16px;
        display: block;
        margin-bottom: 8px;
      }

      @media (max-width: 768px) {
        body {
          padding: 20px 15px;
        }

        h1 {
          font-size: 20px;
        }

        p {
          font-size: 13px;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <a href="/a2-parking/" class="back-link">‚Üê Back to Map</a>
      <h1>About This Project</h1>
    </div>

    <div class="content">
      <div class="fun-facts" id="funFacts">
        <h2>Stats for Nerds</h2>
        <div class="loading" id="loadingFacts">Loading stats...</div>
        <div id="factsContent" style="display: none">
          <!-- Content will be populated by JavaScript -->
        </div>
      </div>

      <p>
        This map displays parking citations issued in Ann Arbor, Michigan. The
        data is collected through automated scraping of the city's public
        parking citation portal.
      </p>

      <div class="methodology">
        <h2>How It Works</h2>
        <p>
          Citation numbers in Ann Arbor's system increment sequentially, but
          they're organized into separate ranges of approximately 20,000
          citations each. Different officers issue tickets across different
          "beats" - UM (University of Michigan) and AA (Ann Arbor) - and each
          beat/officer uses their own citation number ranges. The scraper
          searches multiple windows across these ranges every few minutes to
          capture new citations as they're issued. Each citation is geocoded and
          displayed on this interactive map.
        </p>
      </div>

      <p>
        Below is an example of what a citation receipt looks like when accessed
        through the portal:
      </p>

      <figure class="receipt-image">
        <img
          src="https://annarbor.citationportal.com/Citation/Image?CitationId=43dc0a4e-d6b4-f011-8e59-001dd8b724b7&MediaId=a37de9f0-d6b4-f011-8e59-001dd8b724b7"
          alt="Example parking citation receipt"
        />
        <figcaption>
          Sample parking citation receipt from Ann Arbor's public portal
        </figcaption>
      </figure>

      <p>
        The scraped data includes location info which is then geocoded to
        display citations on this interactive map. Citation images are stored
        and compressed for efficient access. OCR is used to extract text from
        citation images when needed.
      </p>
      <p>
        Inspired by
        <a href="https://walzr.com/sf-parking" target="_blank" rel="noopener"
          >walzr.com/sf-parking</a
        >.
      </p>
    </div>

    <div
      style="
        text-align: center;
        margin-top: 40px;
        padding-top: 30px;
        border-top: 2px solid #00d4ff;
      "
    >
      <a href="/a2-parking/" class="back-link">‚Üê Back to Map</a>
    </div>

    <script>
      async function loadFunFacts() {
        const loadingEl = document.getElementById("loadingFacts");
        const contentEl = document.getElementById("factsContent");

        try {
          const response = await fetch("/api/fun-facts?days=30");
          const result = await response.json();

          if (result.status !== "success" || !result.data) {
            throw new Error(result.error || "Failed to load stats");
          }

          const facts = result.data;
          loadingEl.style.display = "none";
          contentEl.style.display = "block";

          let html = "";

          // Champions section (worst plate and worst location)
          if (
            facts.champions &&
            (facts.champions.worst_plate || facts.champions.worst_location)
          ) {
            html += '<div class="champions-section">';
            html += "<h3>Ann Arbor's Favorite Citizens & Places</h3>";

            if (facts.champions.worst_plate) {
              const plate = facts.champions.worst_plate;
              html += '<div class="champion-item">';
              html += `<strong>ü•á Most Ticketed Plate</strong>`;
              html += `${plate.plate_state} ${
                plate.plate_number
              } ‚Äî <span class="stat-highlight">${
                plate.citation_count
              } tickets</span> ($${plate.total_amount?.toFixed(2) || "0.00"})`;
              html += "</div>";
            }

            if (facts.champions.worst_location) {
              const location = facts.champions.worst_location;
              html += '<div class="champion-item">';
              html += `<strong>üìç Most Ticketed Location</strong>`;
              html += `${location.location} ‚Äî <span class="stat-highlight">${
                location.citation_count
              } tickets</span> (avg $${
                location.avg_amount?.toFixed(2) || "0.00"
              })`;
              html += "</div>";
            }

            html += "</div>";
          }

          // Additional insights
          if (facts.insights) {
            html += '<div class="fun-facts-section">';
            html += "<h3>Overview</h3>";
            html += '<ul class="fun-facts-list">';

            if (
              facts.insights.most_expensive &&
              facts.insights.most_expensive > 0
            ) {
              html += `<li>Most expensive ticket: <span class="stat-highlight">$${facts.insights.most_expensive.toFixed(
                2
              )}</span></li>`;
            }

            if (facts.ticket_pressure && facts.ticket_pressure.total_revenue) {
              html += `<li>Total revenue (last ${
                facts.lookback_days
              } days): <span class="stat-highlight">$${facts.ticket_pressure.total_revenue.toFixed(
                2
              )}</span></li>`;
            }

            if (facts.ticket_pressure && facts.ticket_pressure.total_tickets) {
              html += `<li>Total tickets (last ${facts.lookback_days} days): <span class="stat-highlight">${facts.ticket_pressure.total_tickets}</span></li>`;
            }

            if (facts.insights.worst_day) {
              html += `<li>Worst day of week: <span class="stat-highlight">${facts.insights.worst_day}</span> (${facts.insights.worst_day_count} tickets)</li>`;
            }

            if (
              facts.insights.worst_hour !== null &&
              facts.insights.worst_hour !== undefined
            ) {
              const hour = facts.insights.worst_hour;
              const hour12 = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
              const ampm = hour >= 12 ? "PM" : "AM";
              html += `<li>Worst hour of day: <span class="stat-highlight">${hour12}:00 ${ampm}</span> (${facts.insights.worst_hour_count} tickets)</li>`;
            }

            html += "</ul></div>";
          }

          // Worst places to park
          if (facts.worst_blocks && facts.worst_blocks.length > 0) {
            html += '<div class="fun-facts-section">';
            html += "<h3>Hottest places to park?</h3>";
            html += '<ol class="fun-facts-list">';
            facts.worst_blocks.forEach((block, idx) => {
              html += `<li><strong>#${idx + 1}:</strong> ${
                block.location
              } ‚Äî <span class="stat-highlight">${
                block.citation_count
              } tickets</span> (avg $${
                block.avg_amount?.toFixed(2) || "N/A"
              })</li>`;
            });
            html += "</ol></div>";
          }

          // Repeat offenders
          if (facts.repeat_offenders && facts.repeat_offenders.length > 0) {
            html += '<div class="fun-facts-section">';
            html += "<h3>Top 5 most wanted plates</h3>";
            html += '<ol class="fun-facts-list">';
            facts.repeat_offenders.forEach((offender, idx) => {
              html += `<li><strong>#${idx + 1}:</strong> ${
                offender.plate_state
              } ${offender.plate_number} ‚Äî <span class="stat-highlight">${
                offender.citation_count
              } tickets</span> ($${
                offender.total_amount?.toFixed(2) || "0.00"
              })</li>`;
            });
            html += "</ol></div>";
          }

          // Spicy time windows
          if (facts.spicy_windows && facts.spicy_windows.length > 0) {
            html += '<div class="fun-facts-section">';
            html += "<h3>Worst time to park?</h3>";
            html += '<ol class="fun-facts-list">';
            facts.spicy_windows.forEach((window, idx) => {
              const start = new Date(window.bucket_start);
              const end = new Date(window.bucket_end);
              const timeStr = start.toLocaleTimeString("en-US", {
                hour: "numeric",
                minute: "2-digit",
                hour12: true,
              });
              html += `<li><strong>#${
                idx + 1
              }:</strong> ${timeStr} ‚Äî <span class="stat-highlight">${
                window.citation_count
              } tickets</span> in 30 minutes</li>`;
            });
            html += "</ol></div>";
          }

          // Out of state heat
          if (facts.out_of_state_heat && facts.out_of_state_heat.length > 0) {
            html += '<div class="fun-facts-section">';
            html += "<h3>Which states (not MI) are worst at parking?</h3>";
            html += '<ol class="fun-facts-list">';
            facts.out_of_state_heat.forEach((state, idx) => {
              html += `<li><strong>#${idx + 1}:</strong> ${
                state.plate_state
              } ‚Äî <span class="stat-highlight">${
                state.citation_count
              } tickets</span></li>`;
            });
            html += "</ol></div>";
          }

          if (html === "") {
            html =
              '<div class="fun-facts-section"><p style="text-align: center; color: #888;">No stats available yet. Check back soon!</p></div>';
          }

          contentEl.innerHTML = html;
        } catch (error) {
          loadingEl.style.display = "none";
          contentEl.style.display = "block";
          contentEl.innerHTML = `<div class="error">Failed to load stats: ${error.message}</div>`;
        }
      }

      // Load stats when page loads
      loadFunFacts();
    </script>
  </body>
</html>
