<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ann Arbor Parking Citations Map</title>

    <!-- Meta Tags for Rich Previews -->
    <meta
      name="description"
      content="Interactive map of Ann Arbor parking citations"
    />
    <meta name="author" content="ammar ateya" />

    <!-- Open Graph Tags -->
    <meta property="og:title" content="Ann Arbor Parking Citations Map" />
    <meta
      property="og:description"
      content="Interactive map showing parking citations across Ann Arbor, MI. Real-time tracking of parking tickets with search and notifications."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ og_url }}" />
    <meta property="og:image" content="{{ og_image }}" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:site_name" content="Ann Arbor Parking Citations" />

    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Ann Arbor Parking Citations Map" />
    <meta
      name="twitter:description"
      content="Interactive map showing parking citations across Ann Arbor, MI. Real-time tracking of parking tickets with search and notifications."
    />
    <meta name="twitter:image" content="{{ og_image }}" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/icon.png" />
    <link rel="apple-touch-icon" href="/icon.png" />

    <!-- Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-J001JG2NJ1"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-J001JG2NJ1", {
        page_title: "Main Page",
        page_location: window.location.href,
      });
      gtag("event", "page_view", {
        page_title: "Main Page",
        page_location: window.location.href,
      });
    </script>

    <!-- Leaflet CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <!-- Leaflet MarkerCluster CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="static/css/map.css" />
  </head>
  <body>
    <!-- Side Panel -->
    <div class="side-panel" id="sidePanel">
      <div
        class="side-panel-header"
        style="
          display: flex;
          align-items: center;
          justify-content: space-between;
        "
      >
        <div class="side-panel-title" id="sidePanelTitle">CITATION DETAILS</div>
        <button
          class="control-btn"
          style="padding: 4px 8px; font-size: 10px"
          onclick="closeSidePanel()"
        >
          CLOSE
        </button>
      </div>
      <div class="side-panel-content" id="sidePanelContent">
        <div class="info-item">
          <div class="info-label">SELECT A MARKER</div>
          <div class="info-value">
            Click on a citation marker to view details
          </div>
        </div>
      </div>
    </div>

    <div id="map"></div>

    <div class="header">
      <div class="header-title">ANN ARBOR PARKING CITATIONS</div>
      <div
        style="
          display: flex;
          flex-direction: column;
          align-items: flex-end;
          gap: 4px;
        "
      >
        <div class="header-status">● ONLINE</div>
        <div
          class="header-recent-time"
          id="recentCitationTime"
          style="
            color: #fff;
            font-size: 10px;
            letter-spacing: 0;
            min-height: 14px;
            white-space: nowrap;
            font-family: var(--font-micro);
          "
        ></div>
      </div>
    </div>

    <a
      href="/a2-parking/about/"
      class="info-link"
      title="Fun facts & project info"
    >
      <span class="info-icon">?</span>
      <span>Fun facts & about</span>
    </a>

    <div class="time-filter-bar" id="timeFilterBar">
      <span class="time-filter-label">VIEW:</span>
      <button
        class="time-filter-btn"
        onclick="filterByTime('all')"
        id="filterAll"
        data-time="all"
      >
        ALL
      </button>
      <button
        class="time-filter-btn active"
        onclick="filterByTime('week')"
        id="filterWeek"
        data-time="week"
      >
        PAST WEEK
      </button>
      <button
        class="time-filter-btn"
        onclick="filterByTime('day')"
        id="filterDay"
        data-time="day"
      >
        PAST 24 HOURS
      </button>
      <button
        class="time-filter-btn"
        onclick="filterByTime('hour')"
        id="filterHour"
        data-time="hour"
      >
        PAST HOUR
      </button>
    </div>

    <div class="stats-bar" id="statsBar">
      <div class="stat-item">
        <span class="stat-label">TOTAL CITATIONS</span>
        <span class="stat-value" id="totalCitations">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">TOTAL AMOUNT</span>
        <span class="stat-value" id="totalAmount">$0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">CITATIONS TODAY</span>
        <span class="stat-value" id="totalCitationsToday">0</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">AMOUNT TODAY</span>
        <span class="stat-value" id="totalAmountToday">$0</span>
      </div>
    </div>

    <div class="legend" id="legendBar">
      <div class="legend-header">LEGEND</div>
      <div class="legend-items-row">
        <div class="legend-item">
          <div
            class="legend-marker"
            style="background: rgba(255, 0, 64, 0.7); border: 1px solid #ff0040"
          ></div>
          <span class="legend-text">>= $50: <span id="legendRed">0</span></span>
        </div>
        <div class="legend-item">
          <div
            class="legend-marker"
            style="
              background: rgba(255, 128, 0, 0.7);
              border: 1px solid #ff8000;
            "
          ></div>
          <span class="legend-text"
            >>= $30: <span id="legendOrange">0</span></span
          >
        </div>
        <div class="legend-item">
          <div
            class="legend-marker"
            style="
              background: rgba(0, 212, 255, 0.7);
              border: 1px solid #00d4ff;
            "
          ></div>
          <span class="legend-text"
            >< $30: <span id="legendGreen">0</span></span
          >
        </div>
      </div>
    </div>

    <div class="map-controls">
      <button
        class="control-btn"
        onclick="resetView()"
        id="resetBtn"
        title="Reset view"
        aria-label="Reset view"
      >
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M12 6V3L8 7l4 4V8c2.757 0 5 2.243 5 5s-2.243 5-5 5-5-2.243-5-5H5c0 3.866 3.134 7 7 7s7-3.134 7-7-3.134-7-7-7z"
            fill="#00d4ff"
          />
        </svg>
      </button>
      <button
        class="control-btn"
        onclick="toggleTheme()"
        id="themeBtn"
        title="Toggle theme"
        aria-label="Toggle theme"
      >
      </button>
      <button
        class="control-btn"
        id="searchToggleBtn"
        title="Search"
        aria-label="Search"
      >
      </button>
      <div
        id="searchPanel"
        style="
          display: none;
          background: #0a0a0a;
          border: 2px solid #00d4ff;
          padding: 8px;
          gap: 6px;
          align-items: center;
        "
      >
        <span class="select-wrap">
          <select id="searchMode" class="select-control">
            <option value="plate">PLATE</option>
            <option value="citation">CITATION #</option>
            <option value="location">LOCATION</option>
          </select>
        </span>
        <span
          id="plateInputs"
          style="display: inline-flex; gap: 6px; align-items: center"
        >
          <input
            id="searchPlateState"
            placeholder="MI"
            maxlength="2"
            class="search-input"
            style="width: 56px; text-transform: uppercase"
          />
          <input
            id="searchPlateNumber"
            placeholder="GOBLUE"
            class="search-input"
            style="min-width: 120px; width: 140px"
          />
        </span>
        <span id="citationInputs" style="display: none">
          <input
            id="searchCitationNumber"
            placeholder="CITATION #"
            class="search-input"
            style="min-width: 160px"
          />
        </span>
        <span
          id="locationInputs"
          style="display: none; align-items: center; gap: 6px"
        >
          <button
            class="time-filter-btn"
            id="pickLocationBtn"
            title="Pick center on map"
          >
            PICK
          </button>
          <button
            class="time-filter-btn"
            id="useMyLocationBtn"
            title="Use my current location"
          >
            NEAR ME
          </button>
          <input
            id="searchRadiusMeters"
            type="number"
            min="10"
            max="100000"
            value="250"
            step="10"
            class="search-input"
            style="width: 100px"
          />
          <button
            class="time-filter-btn"
            id="searchRadiusMinus"
            title="decrease radius"
          >
            −
          </button>
          <button
            class="time-filter-btn"
            id="searchRadiusPlus"
            title="increase radius"
          >
            +
          </button>
          <span class="time-filter-label">RADIUS (m)</span>
          <span
            id="searchPickedLocationText"
            style="color: #888; font-size: 10px; margin-left: 6px"
            >center: none</span
          >
        </span>
        <button class="time-filter-btn" id="searchBtn">GO</button>
        <button class="time-filter-btn" id="clearSearchBtn">CLEAR</button>
      </div>
      <button
        class="control-btn"
        id="notifyToggleBtn"
        title="Notifications"
        aria-label="Notifications"
      >
      </button>
      <div
        id="notifyPanel"
        style="
          display: none;
          background: #0a0a0a;
          border: 2px solid #00d4ff;
          padding: 8px;
          gap: 6px;
          align-items: flex-start;
          flex-direction: column;
        "
      >
        <div style="display: flex; gap: 8px; align-items: center">
          <span class="time-filter-label">SUBSCRIBE:</span>
          <span class="select-wrap">
            <select id="notifyMode" class="select-control">
              <option value="plate">PLATE</option>
              <option value="location">LOCATION</option>
            </select>
          </span>
        </div>
        <div
          id="notifyPlate"
          style="display: flex; gap: 6px; align-items: center"
        >
          <input
            id="notifyPlateState"
            placeholder="MI"
            maxlength="2"
            class="search-input"
            style="width: 56px; text-transform: uppercase"
          />
          <input
            id="notifyPlateNumber"
            placeholder="GOBLUE"
            class="search-input"
            style="min-width: 120px; width: 140px"
          />
        </div>
        <div
          id="notifyLocation"
          style="display: none; gap: 6px; align-items: center; flex-wrap: wrap"
        >
          <button
            class="time-filter-btn"
            id="notifyPickCenterBtn"
            title="Pick center on map"
          >
            PICK
          </button>
          <button
            class="time-filter-btn"
            id="notifyUseMyLocationBtn"
            title="Use my current location"
          >
            NEAR ME
          </button>
          <input
            id="notifyRadiusMeters"
            type="number"
            min="10"
            max="100000"
            value="250"
            step="10"
            class="search-input"
            style="width: 100px"
          />
          <button
            class="time-filter-btn"
            id="notifyRadiusMinus"
            title="decrease radius"
          >
            −
          </button>
          <button
            class="time-filter-btn"
            id="notifyRadiusPlus"
            title="increase radius"
          >
            +
          </button>
          <span class="time-filter-label">RADIUS (m)</span>
          <span
            id="notifyPickedText"
            style="color: #888; font-size: 10px; margin-left: 6px"
            >center: none</span
          >
        </div>
        <div
          style="display: flex; gap: 6px; align-items: center; flex-wrap: wrap"
        >
          <input
            id="notifyEmail"
            placeholder="Email (required)"
            class="search-input"
            style="min-width: 200px"
          />
          <button class="time-filter-btn" id="notifySubmitBtn">
            SUBSCRIBE
          </button>
        </div>
        <div id="notifyMsg" style="font-size: 10px; color: #888"></div>
      </div>
      <button
        class="control-btn"
        id="riskScoreToggleBtn"
        title="Parking Risk Score"
        aria-label="Parking Risk Score"
      >
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M12 2L2 7L12 12L22 7L12 2Z"
            stroke="#00d4ff"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            fill="none"
          />
          <path
            d="M2 17L12 22L22 17"
            stroke="#00d4ff"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            fill="none"
          />
          <path
            d="M2 12L12 17L22 12"
            stroke="#00d4ff"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            fill="none"
          />
        </svg>
      </button>
      <div
        id="riskScorePanel"
        style="
          display: none;
          background: #0a0a0a;
          border: 2px solid #00d4ff;
          padding: 12px;
          gap: 10px;
          align-items: flex-start;
          flex-direction: column;
          min-width: 320px;
          max-width: 400px;
        "
      >
        <div
          style="
            color: #00d4ff;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
          "
        >
          PARKING RISK ASSESSMENT
        </div>
        <div
          style="
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
          "
        >
          <span style="color: #888; font-size: 10px; white-space: nowrap"
            >I am parking at</span
          >
          <input
            id="riskAddress"
            placeholder="Address or 'near me'"
            class="search-input"
            style="flex: 1; min-width: 180px"
          />
          <button
            class="time-filter-btn"
            id="riskUseMyLocationBtn"
            title="Use my current location"
          >
            NEAR ME
          </button>
        </div>
        <div
          style="
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
          "
        >
          <span style="color: #888; font-size: 10px; white-space: nowrap"
            >for</span
          >
          <input
            id="riskDuration"
            type="number"
            min="0.25"
            max="168"
            step="0.25"
            value="1"
            class="search-input"
            style="width: 80px"
          />
          <select
            id="riskDurationUnit"
            class="select-control"
            style="width: 80px"
          >
            <option value="hours">hours</option>
            <option value="days">days</option>
          </select>
        </div>
        <div
          style="
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
          "
        >
          <span style="color: #888; font-size: 10px; white-space: nowrap"
            >on</span
          >
          <select id="riskDay" class="select-control" style="flex: 1">
            <option value="0">Monday</option>
            <option value="1">Tuesday</option>
            <option value="2">Wednesday</option>
            <option value="3">Thursday</option>
            <option value="4">Friday</option>
            <option value="5">Saturday</option>
            <option value="6">Sunday</option>
          </select>
          <span style="color: #888; font-size: 10px; white-space: nowrap"
            >at</span
          >
          <input
            id="riskTime"
            type="time"
            class="search-input"
            style="width: 100px"
          />
        </div>
        <button
          class="time-filter-btn"
          id="riskCalculateBtn"
          style="width: 100%; margin-top: 4px"
        >
          CALCULATE RISK
        </button>
        <div
          id="riskResult"
          style="
            display: none;
            margin-top: 12px;
            padding: 12px;
            border: 2px solid #00d4ff;
            width: 100%;
          "
        >
          <div
            id="riskResultText"
            style="
              color: #00d4ff;
              font-size: 12px;
              line-height: 1.6;
              font-family: var(--font-secondary);
            "
          ></div>
          <div
            id="riskResultDetails"
            style="
              margin-top: 10px;
              padding-top: 10px;
              border-top: 1px solid rgba(0, 212, 255, 0.3);
              font-size: 10px;
              color: #888;
              line-height: 1.5;
            "
          ></div>
        </div>
        <div
          id="riskMsg"
          style="font-size: 10px; color: #888; margin-top: 6px"
        ></div>
      </div>
    </div>

    <!-- Location search hint overlay -->
    <div
      id="searchHint"
      style="
        display: none;
        position: fixed;
        bottom: 100px;
        left: 20px;
        background: rgba(10, 10, 10, 0.95);
        border: 2px solid #00d4ff;
        padding: 10px 12px;
        color: #00d4ff;
        z-index: 1200;
        box-shadow: 0 4px 20px rgba(0, 212, 255, 0.3);
        font-weight: bold;
        font-size: 11px;
      "
    >
      CLICK MAP TO SET CENTER • ADJUST RADIUS • PRESS GO
    </div>

    <div class="loading" id="loading">LOADING CITATIONS...</div>

    <div class="no-results-message" id="noResultsMessage">
      <div>NONE FOUND</div>
      <div
        style="font-size: 10px; margin-top: 10px; opacity: 0.8"
        id="noResultsInterval"
      ></div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Leaflet MarkerCluster JS -->
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <!-- Leaflet Heatmap JS -->
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

    <!-- Custom JS -->
    <script src="static/js/map.js" defer></script>
  </body>
</html>
